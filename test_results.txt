============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: C:\Users\vogtt\PyCharmProjects\mlpy
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-1.2.0, cov-7.0.0, timeout-2.4.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 208 items

tests\debugging\test_dap_integration.py .........                        [  4%]
tests\debugging\test_dap_server.py .................................     [ 20%]
tests\debugging\test_debug_handler_example.py ....                       [ 22%]
tests\debugging\test_debugger_p0_critical.py ........................... [ 35%]
...F...                                                                  [ 38%]
tests\debugging\test_debugger_p1_advanced.py ........................... [ 51%]
.....                                                                    [ 53%]
tests\debugging\test_debugger_p2_execution.py .......................... [ 66%]
....                                                                     [ 68%]
tests\debugging\test_debugger_p3_advanced_features.py .................. [ 76%]
................................................
ERROR: Coverage failure: total of 15 is less than fail-under=95
                                                                         [100%]

================================== FAILURES ===================================
________ TestDebuggerIntegration.test_multiple_files_with_breakpoints _________
tests\debugging\test_debugger_p0_critical.py:454: in test_multiple_files_with_breakpoints
    assert bp_id > 0, f"Failed to set breakpoint at {ml_file}:{line}"
E   AssertionError: Failed to set breakpoint at tests/ml_integration/ml_debug/math_utils.ml:5
E   assert -1 > 0
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.7-final-0 _______________

Name                                                     Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------
src\mlpy\__init__.py                                         2      0   100%
src\mlpy\__main__.py                                         3      3     0%   3-6
src\mlpy\cache\__init__.py                                   0      0   100%
src\mlpy\cli\__init__.py                                     4      4     0%   6-10
src\mlpy\cli\app.py                                        830    830     0%   3-2092
src\mlpy\cli\commands.py                                   397    397     0%   6-743
src\mlpy\cli\import_config.py                               84     84     0%   3-238
src\mlpy\cli\main.py                                        81     81     0%   6-203
src\mlpy\cli\project_manager.py                            210    210     0%   6-497
src\mlpy\cli\repl.py                                       918    918     0%   12-1846
src\mlpy\cli\repl_completer.py                              48     48     0%   10-279
src\mlpy\cli\repl_lexer.py                                   8      8     0%   8-132
src\mlpy\dap\__init__.py                                     0      0   100%
src\mlpy\debugging\__init__.py                               0      0   100%
src\mlpy\debugging\dap_server.py                           402    131    67%   89-90, 94-122, 148, 154-156, 178-179, 203, 208, 297-301, 304-308, 321-324, 341-370, 448-450, 459-542, 569-573, 603-608, 690-702, 823-824, 904-918, 986-992, 996
src\mlpy\debugging\debugger.py                             524    374    29%   203-210, 230-237, 256-260, 264-268, 272-276, 299-365, 373-408, 417-427, 440-443, 454-457, 468-488, 506-604, 616-624, 638-700, 704-705, 722-738, 752-764, 768-773, 781-786, 804-832, 837-839, 844-845, 853-860, 882-884, 891-915, 923-943, 954-956, 960-961, 969, 977, 989-994, 1002-1006, 1024-1036, 1044-1049, 1057-1060, 1064, 1072, 1080-1088, 1108-1140, 1154-1155, 1168-1174, 1198-1202
src\mlpy\debugging\error_formatter.py                      190    190     0%   3-418
src\mlpy\debugging\import_hook.py                           71     46    35%   56-65, 69-74, 88-107, 115, 144, 148, 158-191, 195-196, 200-201
src\mlpy\debugging\repl.py                                 350    350     0%   7-731
src\mlpy\debugging\safe_expression_eval.py                 100     88    12%   61-62, 83-169, 181-240, 261-262, 272-274
src\mlpy\debugging\source_map_index.py                      52     12    77%   123-124, 138, 165-176, 187-188, 196
src\mlpy\debugging\variable_formatter.py                   120    101    16%   55-77, 82-87, 92-100, 104-128, 132-163, 167-171, 175-181, 189-204, 223-224, 237-245
src\mlpy\integration\__init__.py                             4      4     0%   32-53
src\mlpy\integration\async_executor.py                      70     70     0%   8-298
src\mlpy\integration\cli_commands.py                       120    120     0%   6-283
src\mlpy\integration\ml_callback.py                         83     83     0%   13-471
src\mlpy\integration\repl_commands.py                      107    107     0%   12-279
src\mlpy\integration\testing\__init__.py                     4      4     0%   37-45
src\mlpy\integration\testing\mocks.py                      142    142     0%   7-375
src\mlpy\integration\testing\performance.py                 65     65     0%   7-284
src\mlpy\integration\testing\test_utilities.py              59     59     0%   7-208
src\mlpy\lsp\__init__.py                                     4      4     0%   6-10
src\mlpy\lsp\capabilities.py                               127    127     0%   6-355
src\mlpy\lsp\handlers.py                                   165    165     0%   6-563
src\mlpy\lsp\semantic_tokens.py                            218    218     0%   6-516
src\mlpy\lsp\semantic_tokens_provider.py                    95     95     0%   6-199
src\mlpy\lsp\server.py                                     272    272     0%   6-595
src\mlpy\ml\__init__.py                                      0      0   100%
src\mlpy\ml\analysis\__init__.py                             2      0   100%
src\mlpy\ml\analysis\ast_analyzer.py                       253    253     0%   3-680
src\mlpy\ml\analysis\ast_transformer.py                    239    239     0%   8-433
src\mlpy\ml\analysis\ast_validator.py                      170    170     0%   12-304
src\mlpy\ml\analysis\data_flow_tracker.py                  297    297     0%   3-644
src\mlpy\ml\analysis\information_collector.py              229    229     0%   11-468
src\mlpy\ml\analysis\optimizer.py                          388    388     0%   8-714
src\mlpy\ml\analysis\parallel_analyzer.py                  144    144     0%   3-305
src\mlpy\ml\analysis\pattern_detector.py                   183    183     0%   3-695
src\mlpy\ml\analysis\security_analyzer.py                  246     99    60%   115-117, 123-148, 171, 192-194, 198-199, 209-222, 226-232, 312-325, 330-332, 336, 340, 344, 360-365, 380, 402-407, 412, 425, 446, 467-468, 473, 477, 481-482, 486-487, 491-493, 497-502, 506-511, 515-520, 525-526, 540-541, 554-561
src\mlpy\ml\analysis\security_deep.py                      376    376     0%   8-945
src\mlpy\ml\analysis\type_checker.py                       431    431     0%   8-774
src\mlpy\ml\ast_backup\__init__.py                           0      0   100%
src\mlpy\ml\codegen\__init__.py                              2      0   100%
src\mlpy\ml\codegen\allowed_functions_registry.py           73     36    51%   61-62, 98-104, 143-151, 162, 174-179, 191-197, 212, 224, 235-240, 252-253, 261-262, 273-274
src\mlpy\ml\codegen\core\__init__.py                         3      0   100%
src\mlpy\ml\codegen\core\context.py                         23      0   100%
src\mlpy\ml\codegen\core\generator_base.py                 192    164    15%   52-65, 79-96, 110-234, 242-250, 254-258, 262-270, 274-275, 279-300, 304, 312, 316, 320, 328-339, 343-359, 363-376, 389, 393-398
src\mlpy\ml\codegen\enhanced_source_maps.py                121     19    84%   98, 106-108, 145, 188-189, 197, 258, 274-293, 301-303
src\mlpy\ml\codegen\helpers\__init__.py                      6      0   100%
src\mlpy\ml\codegen\helpers\expression_helpers.py          172     66    62%   58, 60, 62, 64, 66, 74-76, 84, 95-103, 124-128, 133, 174, 231, 239-289, 311, 318, 327, 335-338, 342, 346, 353, 357-358, 366-367, 388-395, 398-416
src\mlpy\ml\codegen\helpers\function_call_helpers.py       207    167    19%   69-121, 153-181, 210-307, 352-362, 417, 459-486, 499-502, 538-553, 575-604, 628-649, 669-683
src\mlpy\ml\codegen\helpers\module_handlers.py             160    150     6%   59-60, 85-94, 136-181, 206-242, 273-316, 337-352, 401-524
src\mlpy\ml\codegen\helpers\source_map_helpers.py           29     11    62%   92, 96, 98, 137, 185, 219-225
src\mlpy\ml\codegen\helpers\utility_helpers.py              32     11    66%   92-94, 97-100, 156, 160, 199, 204-207
src\mlpy\ml\codegen\python_generator.py                    158     48    70%   154, 161, 167-195, 199-211, 228-230, 244-245, 261-271, 296-303
src\mlpy\ml\codegen\safe_attribute_registry.py             105     79    25%   39-44, 48, 52, 57-74, 78-86, 92-215, 220-296, 311-322, 341-356, 360, 406-649, 659-661
src\mlpy\ml\codegen\systems\__init__.py                      0      0   100%
src\mlpy\ml\codegen\visitors\__init__.py                     4      0   100%
src\mlpy\ml\codegen\visitors\expression_visitors.py         65     47    28%   55, 62, 69, 76, 83, 90, 97, 122-146, 161-165, 183, 193, 204, 226, 244, 265-286, 298
src\mlpy\ml\codegen\visitors\literal_visitors.py            14      6    57%   55, 82, 107, 130, 159, 189
src\mlpy\ml\codegen\visitors\statement_visitors.py         246    134    46%   42-92, 96, 100-101, 105-162, 166-167, 197, 202, 226, 235, 249-252, 281, 287, 302, 325, 337, 344, 348, 360, 365-388, 392-406, 410, 414, 436-452, 457-463
src\mlpy\ml\errors\__init__.py                               0      0   100%
src\mlpy\ml\errors\context.py                              275    203    26%   45-57, 62-66, 71-78, 93, 97, 113-119, 146-160, 164-174, 178-207, 211-239, 247-263, 267-270, 283-420, 424, 430-451, 462-491, 495-498, 541
src\mlpy\ml\errors\exceptions.py                            79     20    75%   74, 106, 115, 128, 135, 142, 149, 162, 178-190, 197, 210, 232, 254
src\mlpy\ml\grammar\__init__.py                              4      0   100%
src\mlpy\ml\grammar\advanced_ast_nodes.py                  350    350     0%   6-642
src\mlpy\ml\grammar\ast_nodes.py                           425    121    72%   17, 42-44, 47, 60-61, 64, 77-79, 82, 96-98, 101, 299-302, 305, 319-322, 325, 332, 335, 342, 345, 352-353, 356, 368-369, 372, 431-434, 437, 498-501, 504, 534, 606-608, 611, 624-626, 629, 642-644, 647, 659-660, 663, 677-680, 683, 696-698, 701, 715-718, 721, 734-736, 739, 748, 752, 756, 760, 764, 768, 772, 776, 780, 784, 788, 792, 796, 800, 804, 808, 812, 816, 820, 824, 828, 832, 836, 840, 844, 848, 852, 856, 860, 864, 868, 872, 876, 881, 885, 889, 893, 897, 901, 905, 909
src\mlpy\ml\grammar\ast_nodes_old.py                       244    244     0%   3-427
src\mlpy\ml\grammar\parser.py                               92     29    68%   42-55, 87, 99, 110, 118-137, 201, 210, 220, 242-270, 295, 307
src\mlpy\ml\grammar\transformer.py                         417    233    44%   20-33, 38, 42-49, 53-60, 64-68, 72-95, 101-118, 122-128, 145, 147, 150-151, 172-175, 182-189, 210, 214-216, 220, 225-233, 238-249, 258-273, 277, 288, 342, 347, 357-374, 382-399, 403, 407, 411, 416-427, 431-438, 444-447, 453, 457, 461, 465, 469, 481, 501, 513, 521, 530, 548, 552-557, 566, 587-610, 614-617, 621-624, 628-631, 638, 642, 654-665, 671, 685, 688, 709-719
src\mlpy\ml\ir\__init__.py                                   0      0   100%
src\mlpy\ml\optimization\__init__.py                         0      0   100%
src\mlpy\ml\parser\__init__.py                               0      0   100%
src\mlpy\ml\resolution\__init__.py                           4      4     0%   3-7
src\mlpy\ml\resolution\cache.py                             94     94     0%   3-212
src\mlpy\ml\resolution\resolver.py                         218    218     0%   3-511
src\mlpy\ml\transpiler.py                                  185    102    45%   46-49, 123, 138-153, 160, 221-223, 244-247, 251-260, 312-403, 407, 411, 425-426, 450, 487, 513, 519-553
src\mlpy\runtime\__init__.py                                 0      0   100%
src\mlpy\runtime\capabilities\__init__.py                    6      0   100%
src\mlpy\runtime\capabilities\bridge_old.py                200    200     0%   10-416
src\mlpy\runtime\capabilities\context.py                   135     93    31%   40-45, 49-55, 59-60, 64-78, 82-96, 100-103, 118-127, 131-135, 139-140, 144-166, 170-178, 182, 186-193, 197-198, 216, 220-228, 232-236, 252, 257, 263-269, 275-278
src\mlpy\runtime\capabilities\decorators.py                 91     74    19%   31-55, 73-100, 127-155, 172-190, 220-234, 242-245, 256-259, 268, 274-292, 297
src\mlpy\runtime\capabilities\enhanced_validator.py        219    219     0%   3-548
src\mlpy\runtime\capabilities\exceptions.py                 23     10    57%   10-11, 18-22, 36, 50, 64, 79
src\mlpy\runtime\capabilities\manager.py                   148    113    24%   20-30, 42-51, 55-65, 69-79, 85-121, 125-132, 136-143, 147-155, 159-160, 164-175, 179-180, 198-219, 225-231, 239-243, 249-257, 275-280, 286-287, 293, 298, 303, 311, 318
src\mlpy\runtime\capabilities\simple_bridge.py              48     48     0%   3-82
src\mlpy\runtime\capabilities\tokens.py                     95     50    47%   39-42, 46-49, 53-56, 84-85, 89-105, 109-110, 115-129, 133-144, 148-169, 173, 200-235, 261-273, 288, 304
src\mlpy\runtime\profiler.py                               449    449     0%   18-1108
src\mlpy\runtime\profiling\__init__.py                       0      0   100%
src\mlpy\runtime\profiling\decorators.py                   173    101    42%   33, 38, 42, 74, 86, 90, 98-103, 107-129, 133-136, 140-141, 145-151, 155-158, 162-201, 228-283, 300, 305, 310, 324-328, 332-337, 341-355, 368
src\mlpy\runtime\sandbox\__init__.py                         5      0   100%
src\mlpy\runtime\sandbox\cache.py                          221    162    27%   30-31, 35, 39-40, 48-53, 57-75, 81-103, 107-108, 112-115, 119-121, 125-133, 137-143, 155-156, 163, 170-190, 200-216, 222-228, 235, 240-261, 272-286, 292-298, 303-315, 323-335, 339-352, 356-366, 370-371, 375-379, 383-384, 388-394, 406-410, 416-420, 426-430, 435
src\mlpy\runtime\sandbox\context_serializer.py             144    115    20%   23, 31-39, 43-50, 55-60, 75-87, 91-120, 124-131, 135-145, 154-166, 170-182, 186, 190-195, 202, 206-207, 211-212, 216-249, 253-257, 261-267, 271-277, 281-288
src\mlpy\runtime\sandbox\resource_monitor.py               162    129    20%   33-36, 44-55, 59-60, 64-79, 83-94, 98-116, 120-134, 138-173, 177-201, 207-227, 239-257, 273-274, 278-283, 287, 291-307, 311-336
src\mlpy\runtime\sandbox\sandbox.py                        225    153    32%   81-82, 102-107, 111-112, 116, 121-125, 129-148, 153-166, 180-210, 220-234, 242-294, 300-405, 409-430, 434-452, 458-459, 463-488, 492-494, 503-510, 517, 521, 527-532
src\mlpy\runtime\system_modules\__init__.py                  0      0   100%
src\mlpy\runtime\system_modules\file_safe.py               138    138     0%   3-214
src\mlpy\runtime\system_modules\math_safe.py                88     88     0%   3-137
src\mlpy\runtime\system_modules\{examples}\__init__.py       0      0   100%
src\mlpy\runtime\whitelist_validator.py                     62     62     0%   17-269
src\mlpy\stdlib\__init__.py                                 12      7    42%   29-35, 43-44
src\mlpy\stdlib\builtin.py                                 268    169    37%   52-72, 90-106, 125-128, 146, 175-192, 212-213, 234-237, 256, 272, 289-296, 311, 332-350, 368-372, 384, 409-424, 440-443, 482-487, 525-531, 563-571, 619-649, 680-687, 715-726, 760-763, 783, 800-802, 819-821, 838, 853, 870, 885, 900, 921, 939, 956, 974, 991, 1008, 1024, 1040, 1056, 1076-1078, 1096, 1112, 1137, 1168-1178, 1189, 1194, 1199
src\mlpy\stdlib\collections_bridge.py                      134    134     0%   16-451
src\mlpy\stdlib\console_bridge.py                           21     21     0%   3-59
src\mlpy\stdlib\datetime_bridge.py                         362    362     0%   22-927
src\mlpy\stdlib\decorators.py                              108     51    53%   54, 106-109, 155-157, 216-228, 259-284, 299, 308, 322, 328, 333, 353-402
src\mlpy\stdlib\file_bridge.py                              90     90     0%   37-431
src\mlpy\stdlib\functional_bridge.py                       218    218     0%   21-635
src\mlpy\stdlib\http_bridge.py                             118    118     0%   43-525
src\mlpy\stdlib\json_bridge.py                              98     98     0%   32-466
src\mlpy\stdlib\math_bridge.py                             117    117     0%   3-203
src\mlpy\stdlib\module_registry.py                         373    310    17%   63-72, 76-81, 85-90, 94-135, 139-186, 190-214, 218-239, 243-263, 280-306, 310-330, 338-359, 363-364, 375-398, 402-403, 414-422, 433-464, 475-481, 485-487, 491, 495, 504-525, 533-557, 568-589, 599-630, 636-638, 642-644, 654-669, 684-711, 719-725, 733-751, 764-774, 792-817, 834-842
src\mlpy\stdlib\path_bridge.py                             101    101     0%   31-535
src\mlpy\stdlib\random_bridge.py                           104    104     0%   21-316
src\mlpy\stdlib\regex_bridge.py                            226    226     0%   43-993
src\mlpy\stdlib\runtime_helpers.py                          70     70     0%   7-203
src\mlpy\version.py                                          2      0   100%
--------------------------------------------------------------------------------------
TOTAL                                                    17940  15175    15%
Coverage HTML written to dir htmlcov
FAIL Required test coverage of 95% not reached. Total coverage: 15.41%
=========================== short test summary info ===========================
FAILED tests/debugging/test_debugger_p0_critical.py::TestDebuggerIntegration::test_multiple_files_with_breakpoints
================== 1 failed, 207 passed in 76.98s (0:01:16) ===================
